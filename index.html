<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FitGarden 2.0 – Fejedelem Edition 💪🌿</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #e0f7fa, #f1f8e9);
  margin: 0;
  padding: 0;
  color: #222;
  overflow-x: hidden;
}
header {
  background: rgba(255,255,255,0.7);
  backdrop-filter: blur(8px);
  padding: 10px;
  text-align: center;
  font-weight: bold;
  font-size: 1.3em;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
#motivationBar {
  background: #004d40;
  color: white;
  padding: 8px;
  text-align: center;
  font-style: italic;
  font-size: 0.95em;
  letter-spacing: 0.3px;
}
main {
  max-width: 1200px;
  margin: 20px auto;
  padding: 15px;
}
.card {
  background: white;
  border-radius: 18px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  padding: 20px;
  margin-bottom: 25px;
}
h2 {
  color: #00796b;
  margin-bottom: 10px;
}
button {
  background: #00796b;
  color: white;
  border: none;
  border-radius: 10px;
  padding: 8px 15px;
  font-size: 0.95em;
  cursor: pointer;
  transition: 0.3s;
}
button:hover {
  background: #004d40;
}
.icon-box {
  display: flex;
  justify-content: space-around;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}
.icon-card {
  flex: 1;
  min-width: 180px;
  background: #e8f5e9;
  border-radius: 12px;
  text-align: center;
  padding: 15px;
  position: relative;
}
.icon-card i {
  font-size: 2em;
  color: #00796b;
  display: block;
}
.icon-card span {
  display: block;
  margin-top: 5px;
  font-weight: bold;
}
.edit-btn {
  position: absolute;
  top: 8px;
  right: 10px;
  background: none;
  color: #00796b;
  border: none;
  font-size: 1.1em;
  cursor: pointer;
}
.hidden { display: none; }

#tabs {
  display: flex;
  justify-content: center;
  margin-bottom: 15px;
}
.tab-btn {
  background: #ccc;
  color: black;
  padding: 10px 20px;
  border-radius: 10px 10px 0 0;
  margin: 0 5px;
  cursor: pointer;
  transition: 0.3s;
}
.tab-btn.active {
  background: #00796b;
  color: white;
}
.tab-content { display: none; }
.tab-content.active { display: block; }

/* === ÚJ CÉL DESIGN === */
.goal-item, .reward-item {
  background: #f8f8f8;
  border-radius: 10px;
  padding: 8px 12px; /* Kisebb padding */
  margin-bottom: 6px; /* Kisebb margó */
  position: relative;
  display: flex; /* Flexbox a sorba rendezéshez */
  justify-content: space-between; /* Elemek szétválasztása */
  align-items: center; /* Középre igazítás */
}
.goal-label {
  display: flex;
  align-items: center;
  cursor: pointer;
  flex-grow: 1;
}
.goal-item input[type="checkbox"] {
  transform: scale(1.2);
  margin-right: 10px;
}
.goal-text.completed { 
  text-decoration: line-through; 
  opacity: 0.7; 
}
.goal-actions, .reward-actions {
  position: static; /* Eltávolítva az abszolút pozíció */
  display: flex;
}
.goal-actions button, .reward-actions button {
  background: transparent;
  color: #00796b;
  font-size: 1.1em;
  margin-left: 5px;
  cursor: pointer;
  padding: 0 3px; /* Gombok belső méretének csökkentése */
}
/* === VÉGE: ÚJ CÉL DESIGN === */


.log {
  background: #f8f8f8;
  border-radius: 10px;
  padding: 10px;
  max-height: 300px;
  overflow-y: auto;
}
.log-entry {
  border-bottom: 1px solid #ddd;
  padding: 6px 0;
  display: flex;
  justify-content: space-between;
}
.log-entry small { color: #777; font-size: 0.85em; }

.modal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.4);
  display: none;
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: white;
  border-radius: 15px;
  padding: 20px;
  width: 90%;
  max-width: 400px;
}
.modal-content h3 { margin-top: 0; color: #00796b; text-align: center; }

input, textarea {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
  margin-bottom: 10px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 1em;
}

#progressChart {
  width: 100%;
  height: 300px;
}

/* === ÚJ: HALADÁSI SÁVOK === */
.progress-container {
  width: 95%;
  background: #c8e6c9; /* Világos zöld háttér */
  border-radius: 10px;
  margin: 10px auto 5px;
  height: 12px;
  overflow: hidden;
  border: 1px solid #a5d6a7;
}
.progress-bar {
  height: 100%;
  width: 0%;
  background: #00796b; /* Sötét zöld sáv */
  border-radius: 10px;
  transition: width 0.5s ease-out;
}
.icon-card small {
  display: block;
  margin-top: 5px;
  color: #333;
  font-weight: 500;
}
/* === VÉGE: HALADÁSI SÁVOK === */

</style>
</head>
<body>
<header>🏋️‍♂️ FitGarden – Fejedelem Edition 🌿</header>
<div id="motivationBar">Tipp: „A lustaság a gyengék vallása. Törj ki belőle.”</div>

<main>
  <div class="card">
    <canvas id="progressChart"></canvas>
  </div>

  <div class="card" id="goalsDisplay">
    <div class="icon-box" id="goalSummary">
      
      <div class="icon-card">
        <button class="edit-btn" onclick="editGoals()">✏️</button>
        <i>⚖️</i>
        <span id="goalWeightText">Cél súly: nincs megadva</span>
        <div class="progress-container">
          <div class="progress-bar" id="weightProgress"></div>
        </div>
        <small id="weightProgressText">Töltsd ki a célokat!</small>
      </div>
      
      <div class="icon-card">
        <button class="edit-btn" onclick="editGoals()">✏️</button>
        <i>💧</i>
        <span id="goalWaterText">Víz cél: nincs megadva</span>
        <div class="progress-container">
          <div class="progress-bar" id="waterProgress"></div>
        </div>
        <small id="waterProgressText">Ma: 0 L / Hátra: 0 L</small>
      </div>
      
      <div class="icon-card">
        <button class="edit-btn" onclick="editGoals()">✏️</button>
        <i>🔥</i>
        <span id="goalCalText">Kalória cél: nincs megadva</span>
        <div class="progress-container">
          <div class="progress-bar" id="calProgress" style="background: #4caf50;"></div>
        </div>
        <small id="calProgressText">Ma: 0 kcal / Hátra: 0 kcal</small>
      </div>

    </div>
  </div>
  <div id="tabs">
    <div class="tab-btn active" onclick="showTab('main')">Főoldal</div>
    <div class="tab-btn" onclick="showTab('notes')">Jegyzetek</div>
    <div class="tab-btn" onclick="showTab('history')">Haladás</div>
  </div>

  <div id="main" class="tab-content active">
    <div class="card">
      <h2>📊 Napi követés</h2>
      <input id="weightInput" type="number" placeholder="Súly (kg)">
      <input id="waterInput" type="number" step="0.1" placeholder="Víz (L)">
      <input id="calInput" type="number" placeholder="Kalória (kcal)">
      <button onclick="addEntry()">Hozzáadás</button>
    </div>

    <div class="card">
      <h2>✅ Célok</h2>
      <button onclick="openModal('goalModal')">+ Új cél</button>
      <div id="goalList"></div>
    </div>

    <div class="card">
      <h2>🎁 Jutalmak</h2>
      <button onclick="openModal('rewardModal')">+ Új jutalom</button>
      <div id="rewardList"></div>
    </div>

    <div class="card">
      <h2>📜 Napló</h2>
      <div class="log" id="activityLog"></div>
      <button style="margin-top:10px" onclick="clearAllLogs()">🧹 Napló törlése</button>
    </div>
  </div>

  <div id="notes" class="tab-content">
    <div class="card">
      <h2>📝 Jegyzetek</h2>
      <textarea id="noteText" placeholder="Írj ide valamit..."></textarea>
      <button onclick="addNote()">Mentés</button>
      <div id="notesList"></div>
    </div>
  </div>

  <div id="history" class="tab-content">
    <div class="card">
      <h2>📅 Napi adatok</h2>
      <div id="historyList"></div>
    </div>
  </div>
</main>
<div class="modal" id="goalSetupModal">
  <div class="modal-content">
    <h3>🎯 Célok beállítása</h3>
    <label>Ideális súly (kg)</label>
    <input id="goalWeightInput" type="number" placeholder="pl. 75">
    <label>Napi víz cél (liter)</label>
    <input id="goalWaterInput" type="number" step="0.1" placeholder="pl. 2.5">
    <label>Napi kalória cél (kcal)</label>
    <input id="goalCalInput" type="number" placeholder="pl. 2200">
    <div style="text-align:center;margin-top:15px;">
      <button onclick="saveGoalSettings()">💾 Mentés</button>
      <button style="background:#ccc;color:black;margin-left:8px;" onclick="closeModal('goalSetupModal')">Mégse</button>
    </div>
  </div>
</div>
<div class="modal" id="goalModal">
  <div class="modal-content">
    <h3>🎯 Új cél</h3>
    <label>Cél neve</label>
    <input id="goalNameInput" type="text" placeholder="pl. 10.000 lépés">
    <label>Pont érték</label>
    <input id="goalPointsInput" type="number" placeholder="pl. 10">
    <div style="text-align:center;margin-top:15px;">
      <button onclick="saveGoal()">✅ Mentés</button>
      <button style="background:#ccc;color:black;margin-left:8px;" onclick="closeModal('goalModal')">Mégse</button>
    </div>
  </div>
</div>
<div class="modal" id="rewardModal">
  <div class="modal-content">
    <h3>🎁 Új jutalom</h3>
    <label>Jutalom neve</label>
    <input id="rewardNameInput" type="text" placeholder="pl. Pihenőnap">
    <label>Pont ára</label>
    <input id="rewardCostInput" type="number" placeholder="pl. 20">
    <div style="text-align:center;margin-top:15px;">
      <button onclick="saveReward()">✅ Mentés</button>
      <button style="background:#ccc;color:black;margin-left:8px;" onclick="closeModal('rewardModal')">Mégse</button>
    </div>
  </div>
</div>
<div class="modal" id="editModal">
  <div class="modal-content">
    <h3 id="editTitle">✏️ Szerkesztés</h3>
    <label id="editLabel1"></label>
    <input id="editInput1" type="text">
    <label id="editLabel2"></label>
    <input id="editInput2" type="number">
    <div style="text-align:center;margin-top:15px;">
      <button onclick="confirmEdit()">💾 Mentés</button>
      <button style="background:#ccc;color:black;margin-left:8px;" onclick="closeModal('editModal')">Mégse</button>
    </div>
  </div>
</div>
<script>
// ======= POPUP VEZÉRLÉS =======
function openModal(id) {
  document.getElementById(id).style.display = 'flex';
}
function closeModal(id) {
  document.getElementById(id).style.display = 'none';
}
function editGoals() {
  // Betöltjük a jelenlegi értékeket a modalba
  document.getElementById("goalWeightInput").value = localStorage.getItem("goalWeight") || "";
  document.getElementById("goalWaterInput").value = localStorage.getItem("goalWater") || "";
  document.getElementById("goalCalInput").value = localStorage.getItem("goalCalories") || "";
  openModal('goalSetupModal');
}
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let goals = JSON.parse(localStorage.getItem("goals")) || [];
let rewards = JSON.parse(localStorage.getItem("rewards")) || [];
let notes = JSON.parse(localStorage.getItem("notes")) || [];
let entries = JSON.parse(localStorage.getItem("entries")) || [];
let logs = JSON.parse(localStorage.getItem("logs")) || [];
let totalPoints = parseInt(localStorage.getItem("totalPoints")) || 0;
let chart;
let editTarget = null;

// ===== TAB KEZELÉS =====
function showTab(id) {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById(id).classList.add('active');
}

// ===== CÉLBEÁLLÍTÁS =====
function saveGoalSettings() {
  const gw = parseFloat(document.getElementById("goalWeightInput").value);
  const gwat = parseFloat(document.getElementById("goalWaterInput").value);
  const gcal = parseFloat(document.getElementById("goalCalInput").value);

  // Csak akkor mentünk, ha érvényes szám (a 0 is az!)
  if (!isNaN(gw)) localStorage.setItem("goalWeight", gw);
  if (!isNaN(gwat)) localStorage.setItem("goalWater", gwat);
  if (!isNaN(gcal)) localStorage.setItem("goalCalories", gcal);

  updateGoalSummary(); // Frissíti a sávokat
  logActivity(`🎯 Célok frissítve.`);
  closeModal('goalSetupModal');
}

// ===== CÉL ÖSSZEFOGLALÓ (HALADÁSI SÁVOK) =====
function updateGoalSummary() {
  const gw = parseFloat(localStorage.getItem("goalWeight"));
  const gwat = parseFloat(localStorage.getItem("goalWater"));
  const gcal = parseFloat(localStorage.getItem("goalCalories"));

  // DOM elemek
  const gwText = document.getElementById("goalWeightText");
  const gwProg = document.getElementById("weightProgress");
  const gwProgText = document.getElementById("weightProgressText");

  const gwatText = document.getElementById("goalWaterText");
  const gwatProg = document.getElementById("waterProgress");
  const gwatProgText = document.getElementById("waterProgressText");

  const gcalText = document.getElementById("goalCalText");
  const gcalProg = document.getElementById("calProgress");
  const gcalProgText = document.getElementById("calProgressText");

  // --- Napi adatok kiszámítása ---
  const todayStr = new Date().toLocaleDateString();
  const todayEntries = entries.filter(e => new Date(e.date).toLocaleDateString() === todayStr);
  
  const todayWater = todayEntries.reduce((sum, e) => sum + (e.water || 0), 0);
  const todayCal = todayEntries.reduce((sum, e) => sum + (e.cal || 0), 0);

  // --- 1. SÚLY CÉL ---
  if (!isNaN(gw)) {
    gwText.textContent = `Cél súly: ${gw} kg`;
    const weightEntries = entries.map(e => e.w).filter(Boolean); // Kiszűri a null/undefined/0 súlyokat
    const startWeight = weightEntries[0];
    const currentWeight = weightEntries[weightEntries.length - 1];

    if (startWeight && currentWeight) {
      const totalToLose = startWeight - gw;
      const lostSoFar = startWeight - currentWeight;
      let percent = (lostSoFar / totalToLose) * 100;
      
      gwProg.style.width = `${Math.max(0, Math.min(100, percent))}%`;
      gwProgText.textContent = `Még ${(currentWeight - gw).toFixed(1)} kg van hátra`;
    } else {
      gwProg.style.width = '0%';
      gwProgText.textContent = "Adj meg súlyt a haladáshoz";
    }
  } else {
    gwText.textContent = "Cél súly: nincs megadva";
    gwProg.style.width = '0%';
    gwProgText.textContent = "Töltsd ki a célokat!";
  }

  // --- 2. VÍZ CÉL ---
  if (!isNaN(gwat)) {
    gwatText.textContent = `Víz cél: ${gwat} L`;
    let percent = (todayWater / gwat) * 100;
    let waterLeft = gwat - todayWater;
    
    gwatProg.style.width = `${Math.max(0, Math.min(100, percent))}%`;
    gwatProgText.textContent = `Ma: ${todayWater.toFixed(1)}L / Hátra: ${Math.max(0, waterLeft).toFixed(1)}L`;
  } else {
    gwatText.textContent = "Víz cél: nincs megadva";
    gwatProg.style.width = '0%';
    gwatProgText.textContent = "Ma: 0 L / Hátra: 0 L";
  }

  // --- 3. KALÓRIA CÉL ---
  if (!isNaN(gcal)) {
    gcalText.textContent = `Kalória cél: ${gcal} kcal`;
    let calLeft = gcal - todayCal;
    // A sáv a HÁTRALÉVŐ mennyiséget mutatja (tele van, és fogy)
    let percentRemaining = (calLeft / gcal) * 100;

    gcalProg.style.width = `${Math.max(0, Math.min(100, percentRemaining))}%`;
    gcalProgText.textContent = `Ma: ${todayCal} kcal / Hátra: ${calLeft} kcal`;
    
    // Színváltás, ha túllépted (a sáv pirosra vált, ha elfogyott)
    gcalProg.style.background = percentRemaining <= 0 ? '#b71c1c' : '#4caf50';
  } else {
    gcalText.textContent = "Kalória cél: nincs megadva";
    gcalProg.style.width = '100%'; // Alapból tele
    gcalProg.style.background = '#4caf50';
    gcalProgText.textContent = "Ma: 0 kcal / Hátra: 0 kcal";
  }
}
// ===== VÉGE: CÉL ÖSSZEFOGLALÓ =====


// ===== NAPI ADATOK =====
// ===== JAVÍTOTT FÜGGVÉNY =====
function addEntry() {
  const w = parseFloat(document.getElementById("weightInput").value);
  const water = parseFloat(document.getElementById("waterInput").value);
  const cal = parseFloat(document.getElementById("calInput").value);
  
  // ===== HIBA JAVÍTVA ITT =====
  // A !w, !water, !cal ellenőrzés hibás volt, mert a 0-t is 'false'-nak (azaz !0 = true) vette.
  // Az isNaN() (Is Not a Number) a helyes ellenőrzés.
  if (isNaN(w) && isNaN(water) && isNaN(cal)) {
    return alert("Adj meg legalább egy értéket!");
  }

  // Az entry-t úgy hozzuk létre, hogy csak a valós számokat mentjük, a NaN-t nem.
  // Ez tisztábbá teszi a mentett adatot és a számításokat.
  const entry = { date: new Date().toLocaleString() };
  if (!isNaN(w)) entry.w = w;
  if (!isNaN(water)) entry.water = water;
  if (!isNaN(cal)) entry.cal = cal;
  
  entries.push(entry);
  localStorage.setItem("entries", JSON.stringify(entries));

  // A logolásnál is a tiszta entry objektumot használjuk
  logActivity(`📊 Új bevitel: ${entry.w !== undefined ? entry.w : "-"}kg, ${entry.water !== undefined ? entry.water : "-"}L, ${entry.cal !== undefined ? entry.cal : "-"}kcal`);
  
  // Mezők kiürítése
  document.getElementById("weightInput").value = "";
  document.getElementById("waterInput").value = "";
  document.getElementById("calInput").value = "";

  // Frissítjük a nézetet
  updateChart();
  updateHistory();
  updateGoalSummary();
}
// ===== VÉGE: JAVÍTOTT FÜGGVÉNY =====

// ===== ÚJ: ADATBEVITELEK TÖRLÉSE =====
function deleteEntry(index) {
  if (confirm("Biztosan törlöd ezt a bejegyzést?")) {
    const deletedEntry = entries[index];
    logActivity(`🗑️ Bejegyzés törölve: ${new Date(deletedEntry.date).toLocaleString()}`);
    
    entries.splice(index, 1);
    localStorage.setItem("entries", JSON.stringify(entries));

    // Mindent frissítünk, ami ezektől függ
    updateChart();
    updateHistory();
    updateGoalSummary();
  }
}


// ===== JEGYZETEK (VÁLTOZATLAN) =====
function addNote() {
  const text = document.getElementById("noteText").value.trim();
  if (!text) return;
  const note = { text, date: new Date().toLocaleString() };
  notes.push(note);
  localStorage.setItem("notes", JSON.stringify(notes));
  document.getElementById("noteText").value = "";
  renderNotes();
  logActivity("📝 Jegyzet hozzáadva");
}
function renderNotes() {
  const container = document.getElementById("notesList");
  container.innerHTML = "";
  notes.forEach((n, i) => {
    const div = document.createElement("div");
    div.style.borderBottom = "1px solid #ddd";
    div.style.padding = "8px 0";
    div.innerHTML = `<b>${n.date}:</b> ${n.text}
      <button style='float:right;background:none;color:#c00;' onclick='deleteNote(${i})'>🗑️</button>`;
    container.appendChild(div);
  });
}
function deleteNote(i) {
  notes.splice(i, 1);
  localStorage.setItem("notes", JSON.stringify(notes));
  renderNotes();
}
// =============================


// ===== CÉLOK =====
// ===== JAVÍTOTT FÜGGVÉNY =====
function saveGoal() {
  const name = document.getElementById("goalNameInput").value.trim();
  const points = parseInt(document.getElementById("goalPointsInput").value);
  
  // ===== HIBA JAVÍTVA ITT =====
  // A !points ellenőrzés nem engedte a 0 pontos célokat.
  if (!name || isNaN(points)) return alert("Add meg a nevet és a pontértéket (lehet 0 is).");
  
  goals.push({ name, points, done: false });
  localStorage.setItem("goals", JSON.stringify(goals));
  document.getElementById("goalNameInput").value = "";
  document.getElementById("goalPointsInput").value = "";
  closeModal('goalModal');
  renderGoals();
  logActivity(`🎯 Cél hozzáadva: ${name} (${points} pont)`);
}
// =============================

function toggleGoal(i) {
  goals[i].done = !goals[i].done;
  if (goals[i].done) {
    totalPoints += goals[i].points;
    logActivity(`✅ Cél teljesítve: ${goals[i].name} (+${goals[i].points} pont)`);
  } else {
    totalPoints -= goals[i].points;
  }
  localStorage.setItem("totalPoints", totalPoints);
  localStorage.setItem("goals", JSON.stringify(goals));
  renderGoals();
  renderRewards();
}

function editGoal(i) {
  editTarget = { type: 'goal', index: i };
  document.getElementById("editTitle").textContent = "🎯 Cél szerkesztése";
  document.getElementById("editLabel1").textContent = "Cél neve";
  document.getElementById("editLabel2").textContent = "Pont érték";
  document.getElementById("editInput1").value = goals[i].name;
  document.getElementById("editInput2").value = goals[i].points;
  openModal('editModal');
}

function deleteGoal(i) {
  goals.splice(i, 1);
  localStorage.setItem("goals", JSON.stringify(goals));
  renderGoals();
}

// ===== MÓDOSÍTOTT RENDERGOALS (ÚJ DESIGN) =====
function renderGoals() {
  const list = document.getElementById("goalList");
  list.innerHTML = `<p>💎 Összes pont: <b>${totalPoints}</b></p>`;
  goals.forEach((g, i) => {
    const div = document.createElement("div");
    div.className = "goal-item"; // A 'completed' osztály mostantól a span-re megy
    div.innerHTML = `
      <label class="goal-label">
        <input type="checkbox" ${g.done ? "checked" : ""} onchange="toggleGoal(${i})">
        <span class="goal-text ${g.done ? "completed" : ""}">${g.name} – ${g.points} pont</span>
      </label>
      <div class="goal-actions">
        <button onclick="editGoal(${i})">✏️</button>
        <button onclick="deleteGoal(${i})">🗑️</button>
      </div>
    `;
    list.appendChild(div);
  });
}
// ======================================


// ===== JUTALMAK =====
// ===== JAVÍTOTT FÜGGVÉNY =====
function saveReward() {
  const name = document.getElementById("rewardNameInput").value.trim();
  const cost = parseInt(document.getElementById("rewardCostInput").value);
  
  // ===== HIBA JAVÍTVA ITT =====
  // A !cost ellenőrzés nem engedte a 0 pontos (ingyenes) jutalmakat.
  if (!name || isNaN(cost)) return alert("Add meg a nevet és a jutalom árát (lehet 0 is).");
  
  rewards.push({ name, cost });
  localStorage.setItem("rewards", JSON.stringify(rewards));
  document.getElementById("rewardNameInput").value = "";
  document.getElementById("rewardCostInput").value = "";
  closeModal('rewardModal');
  renderRewards();
  logActivity(`🎁 Jutalom hozzáadva: ${name} (${cost} pont)`);
}
// =============================

function claimReward(i) {
  if (totalPoints >= rewards[i].cost) {
    totalPoints -= rewards[i].cost;
    localStorage.setItem("totalPoints", totalPoints);
    logActivity(`🎉 Jutalom kiváltva: ${rewards[i].name} (-${rewards[i].cost} pont)`);
    renderRewards();
    renderGoals();
  } else {
    alert("Nincs elég pontod!");
  }
}
function editReward(i) {
  editTarget = { type: 'reward', index: i };
  document.getElementById("editTitle").textContent = "🎁 Jutalom szerkesztése";
  document.getElementById("editLabel1").textContent = "Jutalom neve";
  document.getElementById("editLabel2").textContent = "Pont ára";
  document.getElementById("editInput1").value = rewards[i].name;
  document.getElementById("editInput2").value = rewards[i].cost;
  openModal('editModal');
}
function deleteReward(i) {
  rewards.splice(i, 1);
  localStorage.setItem("rewards", JSON.stringify(rewards));
  renderRewards();
}
function renderRewards() {
  const list = document.getElementById("rewardList");
  list.innerHTML = `<p>💎 Összes pont: <b>${totalPoints}</b></p>`;
  rewards.forEach((r, i) => {
    const div = document.createElement("div");
    div.className = "reward-item";
    div.innerHTML = `
      ${r.name} – ${r.cost} pont
      <div class="reward-actions">
        <button onclick="editReward(${i})">✏️</button>
        <button onclick="deleteReward(${i})">🗑️</button>
        <button onclick="claimReward(${i})">🎉</button>
      </div>
    `;
    list.appendChild(div);
  });
}
// ======================================


// ===== SZERKESZTÉS =====
// ===== JAVÍTOTT FÜGGVÉNY =====
function confirmEdit() {
  const v1 = document.getElementById("editInput1").value;
  const v2 = parseInt(document.getElementById("editInput2").value);
  
  // ===== KONZISZTENCIA JAVÍTÁS =====
  if (!v1 || isNaN(v2)) return alert("A mezők nem lehetnek üresek.");

  if (editTarget.type === 'goal') {
    goals[editTarget.index].name = v1;
    goals[editTarget.index].points = v2;
    localStorage.setItem("goals", JSON.stringify(goals));
    renderGoals();
  } else {
    rewards[editTarget.index].name = v1;
    rewards[editTarget.index].cost = v2;
    localStorage.setItem("rewards", JSON.stringify(rewards));
    renderRewards();
  }
  closeModal('editModal');
}
// =============================

// ===== NAPLÓ =====
function logActivity(text) {
  const time = new Date().toLocaleString();
  const entry = { time, text };
  logs.unshift(entry); // Új elemeket az elejére teszünk
  localStorage.setItem("logs", JSON.stringify(logs));
  renderLogs();
}
function renderLogs() {
  const logDiv = document.getElementById("activityLog");
  logDiv.innerHTML = "";
  logs.forEach((l, i) => { // Már fordított sorrendben vannak az 'unshift' miatt
    const div = document.createElement("div");
    div.className = "log-entry";
    div.innerHTML = `
      <span>${l.text}</span>
      <small>${l.time}</small>
      <button style="background:none;color:#c00" onclick="deleteLog(${i})">🗑️</button>
    `;
    logDiv.appendChild(div);
  });
}
function deleteLog(i) {
  logs.splice(i, 1);
  localStorage.setItem("logs", JSON.stringify(logs));
  renderLogs();
}
function clearAllLogs() {
  if (confirm("Biztos törlöd az összes naplóbejegyzést?")) {
    logs = [];
    localStorage.setItem("logs", JSON.stringify([]));
    renderLogs();
  }
}
// ======================================


// ===== GRAFIKON =====
function updateChart() {
  const ctx = document.getElementById("progressChart");
  const labels = [];
  const weights = [];
  
  entries.forEach(e => {
    // Csak akkor adjuk hozzá, ha a 'w' (súly) definiálva van és nem null
    if (e.w !== undefined && e.w !== null) {
      labels.push(new Date(e.date).toLocaleDateString('hu-HU', { month: 'short', day: 'numeric' }));
      weights.push(e.w);
    }
  });

  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: labels, // Csak a súlyhoz tartozó dátumok
      datasets: [{
        label: "Súly (kg)",
        data: weights, // Csak a súly adatok
        borderWidth: 3,
        borderColor: "#00796b",
        tension: 0.3,
        fill: true,
        backgroundColor: 'rgba(0, 121, 107, 0.1)'
      }]
    },
    options: {
      scales: { y: { beginAtZero: false } }
    }
  });
}

// ===== NAPI MOTIVÁCIÓ (VÁLTOZATLAN) =====
function loadMotivation() {
  const tateTips = [
    "Ne várj kedvre – csak a gyengék várnak rá. Tedd, amit kell.",
    "Ha a tested tiltakozik, az elméd parancsoljon neki.",
    "A fegyelem legyőzi a lustaságot minden nap.",
    "Minden korty víz egy lépés az uralkodás felé.",
    "A férfi, aki nem kontrollálja az étvágyát, nem uralja az életét."
  ];
  const day = new Date().getDate();
  document.getElementById("motivationBar").innerText = `Tipp: „${tateTips[day % tateTips.length]}”`;
}

// ===== MÓDOSÍTOTT HALADÁS TÖRTÉNET (TÖRLÉS GOMB) =====
function updateHistory() {
  const div = document.getElementById("historyList");
  div.innerHTML = "";
  // Fordítva jelenítjük meg (legújabb elöl), de a törléshez az eredeti index kell
  entries.slice().reverse().forEach((e, reversedIndex) => {
    const originalIndex = entries.length - 1 - reversedIndex; // Kiszámítjuk az eredeti indexet
    
    const item = document.createElement("div");
    item.style.borderBottom = "1px solid #ddd";
    item.style.padding = "6px 0";
    item.style.display = "flex";
    item.style.justifyContent = "space-between";
    item.style.alignItems = "center"; // 'align-items'
    
    // Csak a megadott adatokat jelenítjük meg (a 0-t is!)
    let dataStrings = [];
    if (e.w !== undefined && e.w !== null) dataStrings.push(`Súly: ${e.w} kg`);
    if (e.water !== undefined && e.water !== null) dataStrings.push(`Víz: ${e.water} L`);
    if (e.cal !== undefined && e.cal !== null) dataStrings.push(`Kalória: ${e.cal} kcal`);

    item.innerHTML = `
      <div>
        <b>${new Date(e.date).toLocaleString('hu-HU')}</b>
        <div style="font-size:0.9em; color: #333;">${dataStrings.join(', ') || "Nincs adat"}</div>
      </div>
      <button style="background:none; color:#c00; font-size:1.2em; padding: 5px;" onclick="deleteEntry(${originalIndex})">🗑️</button>
    `;
    div.appendChild(item);
  });
}
// ======================================


// ===== EGYSZERŰ ÚJRARAJZOLÁS (VÁLTOZATLAN) =====
function renderAll() {
  renderGoals();
  renderRewards();
  renderNotes();
  renderLogs();
  updateChart();
  updateGoalSummary();
  updateHistory();
  loadMotivation();
}


// ===== INIT (MINDENT BETÖLT) =====
window.onload = function() {
  renderAll(); // Ez az egy függvény mindent elindít
};
</script>

<style>
/* ====== ANIMÁCIÓK ====== */
.fade-in {
  opacity: 0;
  transform: translateY(10px);
  animation: fadeIn 0.6s ease forwards;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
button, .tab-btn {
  transition: transform 0.15s ease;
}
button:hover, .tab-btn:hover {
  transform: scale(1.05);
}

/* ====== EXPORT / RESET PANEL ====== */
#controlPanel {
  text-align: center;
  margin-top: 25px;
}
#controlPanel button {
  background: #004d40;
  margin: 5px;
}
#controlPanel input[type="file"] {
  display: none;
}
</style>

<div class="card fade-in" id="controlPanel">
  <h2>🧠 Fejedelem Kontrollpanel</h2>
  <p>Adatmentés, visszaállítás és teljes reset</p>
  <button onclick="exportData()">💾 Exportálás</button>
  <button onclick="document.getElementById('importFile').click()">📂 Importálás</button>
  <input type="file" id="importFile" accept=".json" onchange="importData(event)">
  <button style="background:#b71c1c" onclick="resetAll()">⚠️ Teljes reset</button>
</div>

<script>
// ====== EXPORT / IMPORT (VÁLTOZATLAN) ======
function exportData() {
  const allData = {
    goals, rewards, notes, entries, logs, totalPoints,
    goalWeight: localStorage.getItem("goalWeight"),
    goalWater: localStorage.getItem("goalWater"),
    goalCalories: localStorage.getItem("goalCalories")
  };
  const blob = new Blob([JSON.stringify(allData, null, 2)], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `FitGarden_Backup_${new Date().toISOString().slice(0,10)}.json`;
  a.click();
  logActivity("💾 Adatok exportálva");
}

function importData(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const data = JSON.parse(e.target.result);
      goals = data.goals || [];
      rewards = data.rewards || [];
      notes = data.notes || [];
      entries = data.entries || [];
      logs = data.logs || [];
      totalPoints = data.totalPoints || 0;
      localStorage.setItem("goalWeight", data.goalWeight || "");
      localStorage.setItem("goalWater", data.goalWater || "");
      localStorage.setItem("goalCalories", data.goalCalories || "");
      localStorage.setItem("goals", JSON.stringify(goals));
      localStorage.setItem("rewards", JSON.stringify(rewards));
      localStorage.setItem("notes", JSON.stringify(notes));
      localStorage.setItem("entries", JSON.stringify(entries));
      localStorage.setItem("logs", JSON.stringify(logs));
      localStorage.setItem("totalPoints", totalPoints);
      renderAll();
      logActivity("📂 Adatok importálva");
      alert("Sikeres importálás! Minden adat frissítve ✅");
    } catch {
      alert("❌ Hiba: a fájl nem megfelelő formátumú!");
    }
  };
  reader.readAsText(file);
}

// ====== TELJES RESET (VÁLTOZATLAN) ======
function resetAll() {
  if (confirm("Biztosan törölni szeretnél MINDENT? Ez végleges!")) {
    localStorage.clear();
    goals = [];
    rewards = [];
    notes = [];
    entries = [];
    logs = [];
    totalPoints = 0;
    // Töröljük a grafikont a memóriából
    if (chart) chart.destroy(); 
    
    renderAll();
    logActivity("⚠️ Teljes rendszer reset");
    alert("FitGarden újraindítva, minden törölve ✅");
  }
}
</script>

</body>
</html>
