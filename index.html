<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FitGarden 2.0 ‚Äì Fejedelem Edition üí™üåø</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #e0f7fa, #f1f8e9);
  margin: 0;
  padding: 0;
  color: #222;
  overflow-x: hidden;
}
header {
  background: rgba(255,255,255,0.7);
  backdrop-filter: blur(8px);
  padding: 10px;
  text-align: center;
  font-weight: bold;
  font-size: 1.3em;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
#motivationBar {
  background: #004d40;
  color: white;
  padding: 8px;
  text-align: center;
  font-style: italic;
  font-size: 0.95em;
  letter-spacing: 0.3px;
}
main {
  max-width: 1200px;
  margin: 20px auto;
  padding: 15px;
}
.card {
  background: white;
  border-radius: 18px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  padding: 20px;
  margin-bottom: 25px;
}
h2 {
  color: #00796b;
  margin-bottom: 10px;
}
button {
  background: #00796b;
  color: white;
  border: none;
  border-radius: 10px;
  padding: 8px 15px;
  font-size: 0.95em;
  cursor: pointer;
  transition: 0.3s;
}
button:hover {
  background: #004d40;
}
.icon-box {
  display: flex;
  justify-content: space-around;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}
.icon-card {
  flex: 1;
  min-width: 180px;
  background: #e8f5e9;
  border-radius: 12px;
  text-align: center;
  padding: 15px;
  position: relative;
}
.icon-card i {
  font-size: 2em;
  color: #00796b;
  display: block;
}
.icon-card span {
  display: block;
  margin-top: 5px;
  font-weight: bold;
}
.edit-btn {
  position: absolute;
  top: 8px;
  right: 10px;
  background: none;
  color: #00796b;
  border: none;
  font-size: 1.1em;
  cursor: pointer;
}
.hidden { display: none; }

#tabs {
  display: flex;
  justify-content: center;
  margin-bottom: 15px;
}
.tab-btn {
  background: #ccc;
  color: black;
  padding: 10px 20px;
  border-radius: 10px 10px 0 0;
  margin: 0 5px;
  cursor: pointer;
  transition: 0.3s;
}
.tab-btn.active {
  background: #00796b;
  color: white;
}
.tab-content { display: none; }
.tab-content.active { display: block; }

/* === √öJ C√âL DESIGN === */
.goal-item, .reward-item {
  background: #f8f8f8;
  border-radius: 10px;
  padding: 8px 12px; /* Kisebb padding */
  margin-bottom: 6px; /* Kisebb marg√≥ */
  position: relative;
  display: flex; /* Flexbox a sorba rendez√©shez */
  justify-content: space-between; /* Elemek sz√©tv√°laszt√°sa */
  align-items: center; /* K√∂z√©pre igaz√≠t√°s */
}
.goal-label {
  display: flex;
  align-items: center;
  cursor: pointer;
  flex-grow: 1;
}
.goal-item input[type="checkbox"] {
  transform: scale(1.2);
  margin-right: 10px;
}
.goal-text.completed { 
  text-decoration: line-through; 
  opacity: 0.7; 
}
.goal-actions, .reward-actions {
  position: static; /* Elt√°vol√≠tva az abszol√∫t poz√≠ci√≥ */
  display: flex;
}
.goal-actions button, .reward-actions button {
  background: transparent;
  color: #00796b;
  font-size: 1.1em;
  margin-left: 5px;
  cursor: pointer;
  padding: 0 3px; /* Gombok bels≈ë m√©ret√©nek cs√∂kkent√©se */
}
/* === V√âGE: √öJ C√âL DESIGN === */


.log {
  background: #f8f8f8;
  border-radius: 10px;
  padding: 10px;
  max-height: 300px;
  overflow-y: auto;
}
.log-entry {
  border-bottom: 1px solid #ddd;
  padding: 6px 0;
  display: flex;
  justify-content: space-between;
}
.log-entry small { color: #777; font-size: 0.85em; }

.modal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.4);
  display: none;
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: white;
  border-radius: 15px;
  padding: 20px;
  width: 90%;
  max-width: 400px;
}
.modal-content h3 { margin-top: 0; color: #00796b; text-align: center; }

input, textarea {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
  margin-bottom: 10px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 1em;
}

#progressChart {
  width: 100%;
  height: 300px;
}

/* === √öJ: HALAD√ÅSI S√ÅVOK === */
.progress-container {
  width: 95%;
  background: #c8e6c9; /* Vil√°gos z√∂ld h√°tt√©r */
  border-radius: 10px;
  margin: 10px auto 5px;
  height: 12px;
  overflow: hidden;
  border: 1px solid #a5d6a7;
}
.progress-bar {
  height: 100%;
  width: 0%;
  background: #00796b; /* S√∂t√©t z√∂ld s√°v */
  border-radius: 10px;
  transition: width 0.5s ease-out;
}
.icon-card small {
  display: block;
  margin-top: 5px;
  color: #333;
  font-weight: 500;
}
/* === V√âGE: HALAD√ÅSI S√ÅVOK === */

</style>
</head>
<body>
<header>üèãÔ∏è‚Äç‚ôÇÔ∏è FitGarden ‚Äì Fejedelem Edition üåø</header>
<div id="motivationBar">Tipp: ‚ÄûA lustas√°g a gyeng√©k vall√°sa. T√∂rj ki bel≈ële.‚Äù</div>

<main>
  <div class="card">
    <canvas id="progressChart"></canvas>
  </div>

  <div class="card" id="goalsDisplay">
    <div class="icon-box" id="goalSummary">
      
      <div class="icon-card">
        <button class="edit-btn" onclick="editGoals()">‚úèÔ∏è</button>
        <i>‚öñÔ∏è</i>
        <span id="goalWeightText">C√©l s√∫ly: nincs megadva</span>
        <div class="progress-container">
          <div class="progress-bar" id="weightProgress"></div>
        </div>
        <small id="weightProgressText">T√∂ltsd ki a c√©lokat!</small>
      </div>
      
      <div class="icon-card">
        <button class="edit-btn" onclick="editGoals()">‚úèÔ∏è</button>
        <i>üíß</i>
        <span id="goalWaterText">V√≠z c√©l: nincs megadva</span>
        <div class="progress-container">
          <div class="progress-bar" id="waterProgress"></div>
        </div>
        <small id="waterProgressText">Ma: 0 L / H√°tra: 0 L</small>
      </div>
      
      <div class="icon-card">
        <button class="edit-btn" onclick="editGoals()">‚úèÔ∏è</button>
        <i>üî•</i>
        <span id="goalCalText">Kal√≥ria c√©l: nincs megadva</span>
        <div class="progress-container">
          <div class="progress-bar" id="calProgress" style="background: #4caf50;"></div>
        </div>
        <small id="calProgressText">Ma: 0 kcal / H√°tra: 0 kcal</small>
      </div>

    </div>
  </div>
  <div id="tabs">
    <div class="tab-btn active" onclick="showTab('main')">F≈ëoldal</div>
    <div class="tab-btn" onclick="showTab('notes')">Jegyzetek</div>
    <div class="tab-btn" onclick="showTab('history')">Halad√°s</div>
  </div>

  <div id="main" class="tab-content active">
    <div class="card">
      <h2>üìä Napi k√∂vet√©s</h2>
      <input id="weightInput" type="number" placeholder="S√∫ly (kg)">
      <input id="waterInput" type="number" step="0.1" placeholder="V√≠z (L)">
      <input id="calInput" type="number" placeholder="Kal√≥ria (kcal)">
      <button onclick="addEntry()">Hozz√°ad√°s</button>
    </div>

    <div class="card">
      <h2>‚úÖ C√©lok</h2>
      <button onclick="openModal('goalModal')">+ √öj c√©l</button>
      <div id="goalList"></div>
    </div>

    <div class="card">
      <h2>üéÅ Jutalmak</h2>
      <button onclick="openModal('rewardModal')">+ √öj jutalom</button>
      <div id="rewardList"></div>
    </div>

    <div class="card">
      <h2>üìú Napl√≥</h2>
      <div class="log" id="activityLog"></div>
      <button style="margin-top:10px" onclick="clearAllLogs()">üßπ Napl√≥ t√∂rl√©se</button>
    </div>
  </div>

  <div id="notes" class="tab-content">
    <div class="card">
      <h2>üìù Jegyzetek</h2>
      <textarea id="noteText" placeholder="√çrj ide valamit..."></textarea>
      <button onclick="addNote()">Ment√©s</button>
      <div id="notesList"></div>
    </div>
  </div>

  <div id="history" class="tab-content">
    <div class="card">
      <h2>üìÖ Napi adatok</h2>
      <div id="historyList"></div>
    </div>
  </div>
</main>
<div class="modal" id="goalSetupModal">
  <div class="modal-content">
    <h3>üéØ C√©lok be√°ll√≠t√°sa</h3>
    <label>Ide√°lis s√∫ly (kg)</label>
    <input id="goalWeightInput" type="number" placeholder="pl. 75">
    <label>Napi v√≠z c√©l (liter)</label>
    <input id="goalWaterInput" type="number" step="0.1" placeholder="pl. 2.5">
    <label>Napi kal√≥ria c√©l (kcal)</label>
    <input id="goalCalInput" type="number" placeholder="pl. 2200">
    <div style="text-align:center;margin-top:15px;">
      <button onclick="saveGoalSettings()">üíæ Ment√©s</button>
      <button style="background:#ccc;color:black;margin-left:8px;" onclick="closeModal('goalSetupModal')">M√©gse</button>
    </div>
  </div>
</div>
<div class="modal" id="goalModal">
  <div class="modal-content">
    <h3>üéØ √öj c√©l</h3>
    <label>C√©l neve</label>
    <input id="goalNameInput" type="text" placeholder="pl. 10.000 l√©p√©s">
    <label>Pont √©rt√©k</label>
    <input id="goalPointsInput" type="number" placeholder="pl. 10">
    <div style="text-align:center;margin-top:15px;">
      <button onclick="saveGoal()">‚úÖ Ment√©s</button>
      <button style="background:#ccc;color:black;margin-left:8px;" onclick="closeModal('goalModal')">M√©gse</button>
    </div>
  </div>
</div>
<div class="modal" id="rewardModal">
  <div class="modal-content">
    <h3>üéÅ √öj jutalom</h3>
    <label>Jutalom neve</label>
    <input id="rewardNameInput" type="text" placeholder="pl. Pihen≈ënap">
    <label>Pont √°ra</label>
    <input id="rewardCostInput" type="number" placeholder="pl. 20">
    <div style="text-align:center;margin-top:15px;">
      <button onclick="saveReward()">‚úÖ Ment√©s</button>
      <button style="background:#ccc;color:black;margin-left:8px;" onclick="closeModal('rewardModal')">M√©gse</button>
    </div>
  </div>
</div>
<div class="modal" id="editModal">
  <div class="modal-content">
    <h3 id="editTitle">‚úèÔ∏è Szerkeszt√©s</h3>
    <label id="editLabel1"></label>
    <input id="editInput1" type="text">
    <label id="editLabel2"></label>
    <input id="editInput2" type="number">
    <div style="text-align:center;margin-top:15px;">
      <button onclick="confirmEdit()">üíæ Ment√©s</button>
      <button style="background:#ccc;color:black;margin-left:8px;" onclick="closeModal('editModal')">M√©gse</button>
    </div>
  </div>
</div>
<script>
// ======= POPUP VEZ√âRL√âS =======
function openModal(id) {
  document.getElementById(id).style.display = 'flex';
}
function closeModal(id) {
  document.getElementById(id).style.display = 'none';
}
function editGoals() {
  // Bet√∂ltj√ºk a jelenlegi √©rt√©keket a modalba
  document.getElementById("goalWeightInput").value = localStorage.getItem("goalWeight") || "";
  document.getElementById("goalWaterInput").value = localStorage.getItem("goalWater") || "";
  document.getElementById("goalCalInput").value = localStorage.getItem("goalCalories") || "";
  openModal('goalSetupModal');
}
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let goals = JSON.parse(localStorage.getItem("goals")) || [];
let rewards = JSON.parse(localStorage.getItem("rewards")) || [];
let notes = JSON.parse(localStorage.getItem("notes")) || [];
let entries = JSON.parse(localStorage.getItem("entries")) || [];
let logs = JSON.parse(localStorage.getItem("logs")) || [];
let totalPoints = parseInt(localStorage.getItem("totalPoints")) || 0;
let chart;
let editTarget = null;

// ===== TAB KEZEL√âS =====
function showTab(id) {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById(id).classList.add('active');
}

// ===== C√âLBE√ÅLL√çT√ÅS =====
function saveGoalSettings() {
  const gw = parseFloat(document.getElementById("goalWeightInput").value);
  const gwat = parseFloat(document.getElementById("goalWaterInput").value);
  const gcal = parseFloat(document.getElementById("goalCalInput").value);

  // Csak akkor ment√ºnk, ha √©rv√©nyes sz√°m (a 0 is az!)
  if (!isNaN(gw)) localStorage.setItem("goalWeight", gw);
  if (!isNaN(gwat)) localStorage.setItem("goalWater", gwat);
  if (!isNaN(gcal)) localStorage.setItem("goalCalories", gcal);

  updateGoalSummary(); // Friss√≠ti a s√°vokat
  logActivity(`üéØ C√©lok friss√≠tve.`);
  closeModal('goalSetupModal');
}

// ===== C√âL √ñSSZEFOGLAL√ì (HALAD√ÅSI S√ÅVOK) =====
function updateGoalSummary() {
  const gw = parseFloat(localStorage.getItem("goalWeight"));
  const gwat = parseFloat(localStorage.getItem("goalWater"));
  const gcal = parseFloat(localStorage.getItem("goalCalories"));

  // DOM elemek
  const gwText = document.getElementById("goalWeightText");
  const gwProg = document.getElementById("weightProgress");
  const gwProgText = document.getElementById("weightProgressText");

  const gwatText = document.getElementById("goalWaterText");
  const gwatProg = document.getElementById("waterProgress");
  const gwatProgText = document.getElementById("waterProgressText");

  const gcalText = document.getElementById("goalCalText");
  const gcalProg = document.getElementById("calProgress");
  const gcalProgText = document.getElementById("calProgressText");

  // --- Napi adatok kisz√°m√≠t√°sa ---
  const todayStr = new Date().toLocaleDateString();
  const todayEntries = entries.filter(e => new Date(e.date).toLocaleDateString() === todayStr);
  
  const todayWater = todayEntries.reduce((sum, e) => sum + (e.water || 0), 0);
  const todayCal = todayEntries.reduce((sum, e) => sum + (e.cal || 0), 0);

  // --- 1. S√öLY C√âL ---
  if (!isNaN(gw)) {
    gwText.textContent = `C√©l s√∫ly: ${gw} kg`;
    const weightEntries = entries.map(e => e.w).filter(Boolean); // Kisz≈±ri a null/undefined/0 s√∫lyokat
    const startWeight = weightEntries[0];
    const currentWeight = weightEntries[weightEntries.length - 1];

    if (startWeight && currentWeight) {
      const totalToLose = startWeight - gw;
      const lostSoFar = startWeight - currentWeight;
      let percent = (lostSoFar / totalToLose) * 100;
      
      gwProg.style.width = `${Math.max(0, Math.min(100, percent))}%`;
      gwProgText.textContent = `M√©g ${(currentWeight - gw).toFixed(1)} kg van h√°tra`;
    } else {
      gwProg.style.width = '0%';
      gwProgText.textContent = "Adj meg s√∫lyt a halad√°shoz";
    }
  } else {
    gwText.textContent = "C√©l s√∫ly: nincs megadva";
    gwProg.style.width = '0%';
    gwProgText.textContent = "T√∂ltsd ki a c√©lokat!";
  }

  // --- 2. V√çZ C√âL ---
  if (!isNaN(gwat)) {
    gwatText.textContent = `V√≠z c√©l: ${gwat} L`;
    let percent = (todayWater / gwat) * 100;
    let waterLeft = gwat - todayWater;
    
    gwatProg.style.width = `${Math.max(0, Math.min(100, percent))}%`;
    gwatProgText.textContent = `Ma: ${todayWater.toFixed(1)}L / H√°tra: ${Math.max(0, waterLeft).toFixed(1)}L`;
  } else {
    gwatText.textContent = "V√≠z c√©l: nincs megadva";
    gwatProg.style.width = '0%';
    gwatProgText.textContent = "Ma: 0 L / H√°tra: 0 L";
  }

  // --- 3. KAL√ìRIA C√âL ---
  if (!isNaN(gcal)) {
    gcalText.textContent = `Kal√≥ria c√©l: ${gcal} kcal`;
    let calLeft = gcal - todayCal;
    // A s√°v a H√ÅTRAL√âV≈ê mennyis√©get mutatja (tele van, √©s fogy)
    let percentRemaining = (calLeft / gcal) * 100;

    gcalProg.style.width = `${Math.max(0, Math.min(100, percentRemaining))}%`;
    gcalProgText.textContent = `Ma: ${todayCal} kcal / H√°tra: ${calLeft} kcal`;
    
    // Sz√≠nv√°lt√°s, ha t√∫ll√©pted (a s√°v pirosra v√°lt, ha elfogyott)
    gcalProg.style.background = percentRemaining <= 0 ? '#b71c1c' : '#4caf50';
  } else {
    gcalText.textContent = "Kal√≥ria c√©l: nincs megadva";
    gcalProg.style.width = '100%'; // Alapb√≥l tele
    gcalProg.style.background = '#4caf50';
    gcalProgText.textContent = "Ma: 0 kcal / H√°tra: 0 kcal";
  }
}
// ===== V√âGE: C√âL √ñSSZEFOGLAL√ì =====


// ===== NAPI ADATOK =====
// ===== JAV√çTOTT F√úGGV√âNY =====
function addEntry() {
  const w = parseFloat(document.getElementById("weightInput").value);
  const water = parseFloat(document.getElementById("waterInput").value);
  const cal = parseFloat(document.getElementById("calInput").value);
  
  // ===== HIBA JAV√çTVA ITT =====
  // A !w, !water, !cal ellen≈ërz√©s hib√°s volt, mert a 0-t is 'false'-nak (azaz !0 = true) vette.
  // Az isNaN() (Is Not a Number) a helyes ellen≈ërz√©s.
  if (isNaN(w) && isNaN(water) && isNaN(cal)) {
    return alert("Adj meg legal√°bb egy √©rt√©ket!");
  }

  // Az entry-t √∫gy hozzuk l√©tre, hogy csak a val√≥s sz√°mokat mentj√ºk, a NaN-t nem.
  // Ez tiszt√°bb√° teszi a mentett adatot √©s a sz√°m√≠t√°sokat.
  const entry = { date: new Date().toLocaleString() };
  if (!isNaN(w)) entry.w = w;
  if (!isNaN(water)) entry.water = water;
  if (!isNaN(cal)) entry.cal = cal;
  
  entries.push(entry);
  localStorage.setItem("entries", JSON.stringify(entries));

  // A logol√°sn√°l is a tiszta entry objektumot haszn√°ljuk
  logActivity(`üìä √öj bevitel: ${entry.w !== undefined ? entry.w : "-"}kg, ${entry.water !== undefined ? entry.water : "-"}L, ${entry.cal !== undefined ? entry.cal : "-"}kcal`);
  
  // Mez≈ëk ki√ºr√≠t√©se
  document.getElementById("weightInput").value = "";
  document.getElementById("waterInput").value = "";
  document.getElementById("calInput").value = "";

  // Friss√≠tj√ºk a n√©zetet
  updateChart();
  updateHistory();
  updateGoalSummary();
}
// ===== V√âGE: JAV√çTOTT F√úGGV√âNY =====

// ===== √öJ: ADATBEVITELEK T√ñRL√âSE =====
function deleteEntry(index) {
  if (confirm("Biztosan t√∂rl√∂d ezt a bejegyz√©st?")) {
    const deletedEntry = entries[index];
    logActivity(`üóëÔ∏è Bejegyz√©s t√∂r√∂lve: ${new Date(deletedEntry.date).toLocaleString()}`);
    
    entries.splice(index, 1);
    localStorage.setItem("entries", JSON.stringify(entries));

    // Mindent friss√≠t√ºnk, ami ezekt≈ël f√ºgg
    updateChart();
    updateHistory();
    updateGoalSummary();
  }
}


// ===== JEGYZETEK (V√ÅLTOZATLAN) =====
function addNote() {
  const text = document.getElementById("noteText").value.trim();
  if (!text) return;
  const note = { text, date: new Date().toLocaleString() };
  notes.push(note);
  localStorage.setItem("notes", JSON.stringify(notes));
  document.getElementById("noteText").value = "";
  renderNotes();
  logActivity("üìù Jegyzet hozz√°adva");
}
function renderNotes() {
  const container = document.getElementById("notesList");
  container.innerHTML = "";
  notes.forEach((n, i) => {
    const div = document.createElement("div");
    div.style.borderBottom = "1px solid #ddd";
    div.style.padding = "8px 0";
    div.innerHTML = `<b>${n.date}:</b> ${n.text}
      <button style='float:right;background:none;color:#c00;' onclick='deleteNote(${i})'>üóëÔ∏è</button>`;
    container.appendChild(div);
  });
}
function deleteNote(i) {
  notes.splice(i, 1);
  localStorage.setItem("notes", JSON.stringify(notes));
  renderNotes();
}
// =============================


// ===== C√âLOK =====
// ===== JAV√çTOTT F√úGGV√âNY =====
function saveGoal() {
  const name = document.getElementById("goalNameInput").value.trim();
  const points = parseInt(document.getElementById("goalPointsInput").value);
  
  // ===== HIBA JAV√çTVA ITT =====
  // A !points ellen≈ërz√©s nem engedte a 0 pontos c√©lokat.
  if (!name || isNaN(points)) return alert("Add meg a nevet √©s a pont√©rt√©ket (lehet 0 is).");
  
  goals.push({ name, points, done: false });
  localStorage.setItem("goals", JSON.stringify(goals));
  document.getElementById("goalNameInput").value = "";
  document.getElementById("goalPointsInput").value = "";
  closeModal('goalModal');
  renderGoals();
  logActivity(`üéØ C√©l hozz√°adva: ${name} (${points} pont)`);
}
// =============================

function toggleGoal(i) {
  goals[i].done = !goals[i].done;
  if (goals[i].done) {
    totalPoints += goals[i].points;
    logActivity(`‚úÖ C√©l teljes√≠tve: ${goals[i].name} (+${goals[i].points} pont)`);
  } else {
    totalPoints -= goals[i].points;
  }
  localStorage.setItem("totalPoints", totalPoints);
  localStorage.setItem("goals", JSON.stringify(goals));
  renderGoals();
  renderRewards();
}

function editGoal(i) {
  editTarget = { type: 'goal', index: i };
  document.getElementById("editTitle").textContent = "üéØ C√©l szerkeszt√©se";
  document.getElementById("editLabel1").textContent = "C√©l neve";
  document.getElementById("editLabel2").textContent = "Pont √©rt√©k";
  document.getElementById("editInput1").value = goals[i].name;
  document.getElementById("editInput2").value = goals[i].points;
  openModal('editModal');
}

function deleteGoal(i) {
  goals.splice(i, 1);
  localStorage.setItem("goals", JSON.stringify(goals));
  renderGoals();
}

// ===== M√ìDOS√çTOTT RENDERGOALS (√öJ DESIGN) =====
function renderGoals() {
  const list = document.getElementById("goalList");
  list.innerHTML = `<p>üíé √ñsszes pont: <b>${totalPoints}</b></p>`;
  goals.forEach((g, i) => {
    const div = document.createElement("div");
    div.className = "goal-item"; // A 'completed' oszt√°ly mostant√≥l a span-re megy
    div.innerHTML = `
      <label class="goal-label">
        <input type="checkbox" ${g.done ? "checked" : ""} onchange="toggleGoal(${i})">
        <span class="goal-text ${g.done ? "completed" : ""}">${g.name} ‚Äì ${g.points} pont</span>
      </label>
      <div class="goal-actions">
        <button onclick="editGoal(${i})">‚úèÔ∏è</button>
        <button onclick="deleteGoal(${i})">üóëÔ∏è</button>
      </div>
    `;
    list.appendChild(div);
  });
}
// ======================================


// ===== JUTALMAK =====
// ===== JAV√çTOTT F√úGGV√âNY =====
function saveReward() {
  const name = document.getElementById("rewardNameInput").value.trim();
  const cost = parseInt(document.getElementById("rewardCostInput").value);
  
  // ===== HIBA JAV√çTVA ITT =====
  // A !cost ellen≈ërz√©s nem engedte a 0 pontos (ingyenes) jutalmakat.
  if (!name || isNaN(cost)) return alert("Add meg a nevet √©s a jutalom √°r√°t (lehet 0 is).");
  
  rewards.push({ name, cost });
  localStorage.setItem("rewards", JSON.stringify(rewards));
  document.getElementById("rewardNameInput").value = "";
  document.getElementById("rewardCostInput").value = "";
  closeModal('rewardModal');
  renderRewards();
  logActivity(`üéÅ Jutalom hozz√°adva: ${name} (${cost} pont)`);
}
// =============================

function claimReward(i) {
  if (totalPoints >= rewards[i].cost) {
    totalPoints -= rewards[i].cost;
    localStorage.setItem("totalPoints", totalPoints);
    logActivity(`üéâ Jutalom kiv√°ltva: ${rewards[i].name} (-${rewards[i].cost} pont)`);
    renderRewards();
    renderGoals();
  } else {
    alert("Nincs el√©g pontod!");
  }
}
function editReward(i) {
  editTarget = { type: 'reward', index: i };
  document.getElementById("editTitle").textContent = "üéÅ Jutalom szerkeszt√©se";
  document.getElementById("editLabel1").textContent = "Jutalom neve";
  document.getElementById("editLabel2").textContent = "Pont √°ra";
  document.getElementById("editInput1").value = rewards[i].name;
  document.getElementById("editInput2").value = rewards[i].cost;
  openModal('editModal');
}
function deleteReward(i) {
  rewards.splice(i, 1);
  localStorage.setItem("rewards", JSON.stringify(rewards));
  renderRewards();
}
function renderRewards() {
  const list = document.getElementById("rewardList");
  list.innerHTML = `<p>üíé √ñsszes pont: <b>${totalPoints}</b></p>`;
  rewards.forEach((r, i) => {
    const div = document.createElement("div");
    div.className = "reward-item";
    div.innerHTML = `
      ${r.name} ‚Äì ${r.cost} pont
      <div class="reward-actions">
        <button onclick="editReward(${i})">‚úèÔ∏è</button>
        <button onclick="deleteReward(${i})">üóëÔ∏è</button>
        <button onclick="claimReward(${i})">üéâ</button>
      </div>
    `;
    list.appendChild(div);
  });
}
// ======================================


// ===== SZERKESZT√âS =====
// ===== JAV√çTOTT F√úGGV√âNY =====
function confirmEdit() {
  const v1 = document.getElementById("editInput1").value;
  const v2 = parseInt(document.getElementById("editInput2").value);
  
  // ===== KONZISZTENCIA JAV√çT√ÅS =====
  if (!v1 || isNaN(v2)) return alert("A mez≈ëk nem lehetnek √ºresek.");

  if (editTarget.type === 'goal') {
    goals[editTarget.index].name = v1;
    goals[editTarget.index].points = v2;
    localStorage.setItem("goals", JSON.stringify(goals));
    renderGoals();
  } else {
    rewards[editTarget.index].name = v1;
    rewards[editTarget.index].cost = v2;
    localStorage.setItem("rewards", JSON.stringify(rewards));
    renderRewards();
  }
  closeModal('editModal');
}
// =============================

// ===== NAPL√ì =====
function logActivity(text) {
  const time = new Date().toLocaleString();
  const entry = { time, text };
  logs.unshift(entry); // √öj elemeket az elej√©re tesz√ºnk
  localStorage.setItem("logs", JSON.stringify(logs));
  renderLogs();
}
function renderLogs() {
  const logDiv = document.getElementById("activityLog");
  logDiv.innerHTML = "";
  logs.forEach((l, i) => { // M√°r ford√≠tott sorrendben vannak az 'unshift' miatt
    const div = document.createElement("div");
    div.className = "log-entry";
    div.innerHTML = `
      <span>${l.text}</span>
      <small>${l.time}</small>
      <button style="background:none;color:#c00" onclick="deleteLog(${i})">üóëÔ∏è</button>
    `;
    logDiv.appendChild(div);
  });
}
function deleteLog(i) {
  logs.splice(i, 1);
  localStorage.setItem("logs", JSON.stringify(logs));
  renderLogs();
}
function clearAllLogs() {
  if (confirm("Biztos t√∂rl√∂d az √∂sszes napl√≥bejegyz√©st?")) {
    logs = [];
    localStorage.setItem("logs", JSON.stringify([]));
    renderLogs();
  }
}
// ======================================


// ===== GRAFIKON =====
function updateChart() {
  const ctx = document.getElementById("progressChart");
  const labels = [];
  const weights = [];
  
  entries.forEach(e => {
    // Csak akkor adjuk hozz√°, ha a 'w' (s√∫ly) defini√°lva van √©s nem null
    if (e.w !== undefined && e.w !== null) {
      labels.push(new Date(e.date).toLocaleDateString('hu-HU', { month: 'short', day: 'numeric' }));
      weights.push(e.w);
    }
  });

  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: labels, // Csak a s√∫lyhoz tartoz√≥ d√°tumok
      datasets: [{
        label: "S√∫ly (kg)",
        data: weights, // Csak a s√∫ly adatok
        borderWidth: 3,
        borderColor: "#00796b",
        tension: 0.3,
        fill: true,
        backgroundColor: 'rgba(0, 121, 107, 0.1)'
      }]
    },
    options: {
      scales: { y: { beginAtZero: false } }
    }
  });
}

// ===== NAPI MOTIV√ÅCI√ì (V√ÅLTOZATLAN) =====
function loadMotivation() {
  const tateTips = [
    "Ne v√°rj kedvre ‚Äì csak a gyeng√©k v√°rnak r√°. Tedd, amit kell.",
    "Ha a tested tiltakozik, az elm√©d parancsoljon neki.",
    "A fegyelem legy≈ëzi a lustas√°got minden nap.",
    "Minden korty v√≠z egy l√©p√©s az uralkod√°s fel√©.",
    "A f√©rfi, aki nem kontroll√°lja az √©tv√°gy√°t, nem uralja az √©let√©t."
  ];
  const day = new Date().getDate();
  document.getElementById("motivationBar").innerText = `Tipp: ‚Äû${tateTips[day % tateTips.length]}‚Äù`;
}

// ===== M√ìDOS√çTOTT HALAD√ÅS T√ñRT√âNET (T√ñRL√âS GOMB) =====
function updateHistory() {
  const div = document.getElementById("historyList");
  div.innerHTML = "";
  // Ford√≠tva jelen√≠tj√ºk meg (leg√∫jabb el√∂l), de a t√∂rl√©shez az eredeti index kell
  entries.slice().reverse().forEach((e, reversedIndex) => {
    const originalIndex = entries.length - 1 - reversedIndex; // Kisz√°m√≠tjuk az eredeti indexet
    
    const item = document.createElement("div");
    item.style.borderBottom = "1px solid #ddd";
    item.style.padding = "6px 0";
    item.style.display = "flex";
    item.style.justifyContent = "space-between";
    item.style.alignItems = "center"; // 'align-items'
    
    // Csak a megadott adatokat jelen√≠tj√ºk meg (a 0-t is!)
    let dataStrings = [];
    if (e.w !== undefined && e.w !== null) dataStrings.push(`S√∫ly: ${e.w} kg`);
    if (e.water !== undefined && e.water !== null) dataStrings.push(`V√≠z: ${e.water} L`);
    if (e.cal !== undefined && e.cal !== null) dataStrings.push(`Kal√≥ria: ${e.cal} kcal`);

    item.innerHTML = `
      <div>
        <b>${new Date(e.date).toLocaleString('hu-HU')}</b>
        <div style="font-size:0.9em; color: #333;">${dataStrings.join(', ') || "Nincs adat"}</div>
      </div>
      <button style="background:none; color:#c00; font-size:1.2em; padding: 5px;" onclick="deleteEntry(${originalIndex})">üóëÔ∏è</button>
    `;
    div.appendChild(item);
  });
}
// ======================================


// ===== EGYSZER≈∞ √öJRARAJZOL√ÅS (V√ÅLTOZATLAN) =====
function renderAll() {
  renderGoals();
  renderRewards();
  renderNotes();
  renderLogs();
  updateChart();
  updateGoalSummary();
  updateHistory();
  loadMotivation();
}


// ===== INIT (MINDENT BET√ñLT) =====
window.onload = function() {
  renderAll(); // Ez az egy f√ºggv√©ny mindent elind√≠t
};
</script>

<style>
/* ====== ANIM√ÅCI√ìK ====== */
.fade-in {
  opacity: 0;
  transform: translateY(10px);
  animation: fadeIn 0.6s ease forwards;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
button, .tab-btn {
  transition: transform 0.15s ease;
}
button:hover, .tab-btn:hover {
  transform: scale(1.05);
}

/* ====== EXPORT / RESET PANEL ====== */
#controlPanel {
  text-align: center;
  margin-top: 25px;
}
#controlPanel button {
  background: #004d40;
  margin: 5px;
}
#controlPanel input[type="file"] {
  display: none;
}
</style>

<div class="card fade-in" id="controlPanel">
  <h2>üß† Fejedelem Kontrollpanel</h2>
  <p>Adatment√©s, vissza√°ll√≠t√°s √©s teljes reset</p>
  <button onclick="exportData()">üíæ Export√°l√°s</button>
  <button onclick="document.getElementById('importFile').click()">üìÇ Import√°l√°s</button>
  <input type="file" id="importFile" accept=".json" onchange="importData(event)">
  <button style="background:#b71c1c" onclick="resetAll()">‚ö†Ô∏è Teljes reset</button>
</div>

<script>
// ====== EXPORT / IMPORT (V√ÅLTOZATLAN) ======
function exportData() {
  const allData = {
    goals, rewards, notes, entries, logs, totalPoints,
    goalWeight: localStorage.getItem("goalWeight"),
    goalWater: localStorage.getItem("goalWater"),
    goalCalories: localStorage.getItem("goalCalories")
  };
  const blob = new Blob([JSON.stringify(allData, null, 2)], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `FitGarden_Backup_${new Date().toISOString().slice(0,10)}.json`;
  a.click();
  logActivity("üíæ Adatok export√°lva");
}

function importData(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const data = JSON.parse(e.target.result);
      goals = data.goals || [];
      rewards = data.rewards || [];
      notes = data.notes || [];
      entries = data.entries || [];
      logs = data.logs || [];
      totalPoints = data.totalPoints || 0;
      localStorage.setItem("goalWeight", data.goalWeight || "");
      localStorage.setItem("goalWater", data.goalWater || "");
      localStorage.setItem("goalCalories", data.goalCalories || "");
      localStorage.setItem("goals", JSON.stringify(goals));
      localStorage.setItem("rewards", JSON.stringify(rewards));
      localStorage.setItem("notes", JSON.stringify(notes));
      localStorage.setItem("entries", JSON.stringify(entries));
      localStorage.setItem("logs", JSON.stringify(logs));
      localStorage.setItem("totalPoints", totalPoints);
      renderAll();
      logActivity("üìÇ Adatok import√°lva");
      alert("Sikeres import√°l√°s! Minden adat friss√≠tve ‚úÖ");
    } catch {
      alert("‚ùå Hiba: a f√°jl nem megfelel≈ë form√°tum√∫!");
    }
  };
  reader.readAsText(file);
}

// ====== TELJES RESET (V√ÅLTOZATLAN) ======
function resetAll() {
  if (confirm("Biztosan t√∂r√∂lni szeretn√©l MINDENT? Ez v√©gleges!")) {
    localStorage.clear();
    goals = [];
    rewards = [];
    notes = [];
    entries = [];
    logs = [];
    totalPoints = 0;
    // T√∂r√∂lj√ºk a grafikont a mem√≥ri√°b√≥l
    if (chart) chart.destroy(); 
    
    renderAll();
    logActivity("‚ö†Ô∏è Teljes rendszer reset");
    alert("FitGarden √∫jraind√≠tva, minden t√∂r√∂lve ‚úÖ");
  }
}
</script>

</body>
</html>
